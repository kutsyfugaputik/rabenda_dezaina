// –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –º–æ–¥–µ–ª—å —Å–∫–∏–¥–æ–∫ –∏–∑ –º–æ–¥—É–ª—è —Å –ë–î
const { Discounts } = require('../modules/modules');

// –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∫–ª–∞—Å—Å –æ—à–∏–±–æ–∫
const ApiError = require('../error/ApiError');

// –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –ª–æ–≥–≥–µ—Ä –¥–ª—è –∑–∞–ø–∏—Å–∏ –ª–æ–≥–æ–≤ –≤ —Ñ–∞–π–ª –∏ –≤ –∫–æ–Ω—Å–æ–ª—å
const logAction = require('../utils/logger');

// –ö–ª–∞—Å—Å-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∫–∏–¥–∫–∞–º–∏
class DiscountController {
    // –ú–µ—Ç–æ–¥: –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Å–∫–∏–¥–∫–∏
    async getAll(req, res, next) {
        logAction('–ó–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–∫–∏–¥–æ–∫', 'üì•'); // –õ–æ–≥–∏—Ä—É–µ–º –¥–µ–π—Å—Ç–≤–∏–µ

        try {
            const discounts = await Discounts.findAll(); // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Å–∫–∏–¥–∫–∏ –∏–∑ –ë–î

            logAction(`–ù–∞–π–¥–µ–Ω–æ —Å–∫–∏–¥–æ–∫: ${discounts.length}`, 'üîç'); // –õ–æ–≥–∏—Ä—É–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
            return res.json(discounts); // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–ª–∏–µ–Ω—Ç—É –¥–∞–Ω–Ω—ã–µ
        } catch (error) {
            logAction(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –≤—Å–µ—Ö —Å–∫–∏–¥–æ–∫: ${error.message}`, '‚ùå'); // –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É
            return next(ApiError.internal('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –≤—Å–µ—Ö —Å–∫–∏–¥–æ–∫')); // –ü—Ä–æ–∫–∏–¥—ã–≤–∞–µ–º –≤ middleware
        }
    }

    // –ú–µ—Ç–æ–¥: –ø–æ–ª—É—á–∏—Ç—å —Å–∫–∏–¥–∫—É –ø–æ ID
    async getById(req, res, next) {
        const { id } = req.params; // –ü–æ–ª—É—á–∞–µ–º ID –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –º–∞—Ä—à—Ä—É—Ç–∞
        logAction(`–ó–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–∫–∏–¥–∫–∏ —Å ID: ${id}`, 'üì•'); // –õ–æ–≥–∏—Ä—É–µ–º –Ω–∞—á–∞–ª–æ –∑–∞–ø—Ä–æ—Å–∞

        try {
            const discount = await Discounts.findOne({ where: { id } }); // –ò—â–µ–º —Å–∫–∏–¥–∫—É –ø–æ ID

            if (!discount) {
                logAction(`–°–∫–∏–¥–∫–∞ —Å ID ${id} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞`, '‚ö†Ô∏è'); // –õ–æ–≥–∏—Ä—É–µ–º, –µ—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏
                return next(ApiError.notFound('–°–∫–∏–¥–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞')); // –ü—Ä–æ–∫–∏–¥—ã–≤–∞–µ–º 404 –æ—à–∏–±–∫—É
            }

            logAction(`–°–∫–∏–¥–∫–∞ —Å ID ${id} –Ω–∞–π–¥–µ–Ω–∞: ${JSON.stringify(discount)}`, '‚úÖ'); // –õ–æ–≥–∏—Ä—É–µ–º —É—Å–ø–µ—Ö
            return res.json(discount); // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–∫–∏–¥–∫—É –∫–ª–∏–µ–Ω—Ç—É
        } catch (error) {
            logAction(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–∫–∏–¥–∫–∏ —Å ID ${id}: ${error.message}`, '‚ùå'); // –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É
            return next(ApiError.internal('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–∫–∏–¥–∫–∏')); // –ü—Ä–æ–∫–∏–¥—ã–≤–∞–µ–º –≤ middleware
        }
    }
}

// –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞
module.exports = new DiscountController();
