const express = require('express'); // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É express –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤
const router = express.Router(); // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–∞
const masterController = require('../controllers/masterController'); // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–∞—Å—Ç–µ—Ä–∞–º–∏
const authMiddleware = require('../middleware/authMiddleware'); // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º middleware –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const roleMiddleware = require('../middleware/roleMiddleware'); // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const logAction = require('../utils/logger'); // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –ª–æ–≥–≥–µ—Ä –¥–ª—è –∑–∞–ø–∏—Å–∏ –ª–æ–≥–æ–≤
const ApiError = require('../error/ApiError'); // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º ApiError –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

// –†–æ—É—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö –º–∞—Å—Ç–µ—Ä–æ–≤
router.get('/', async (req, res, next) => {
    try {
        logAction('–ü–æ–ª—É—á–µ–Ω –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö –º–∞—Å—Ç–µ—Ä–æ–≤.', 'üìù'); // –õ–æ–≥–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö –º–∞—Å—Ç–µ—Ä–æ–≤
        await masterController.getAll(req, res); // –í—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞ getAll –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö –º–∞—Å—Ç–µ—Ä–æ–≤
        logAction('–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –º–∞—Å—Ç–µ—Ä–æ–≤ —É—Å–ø–µ—à–Ω–æ –≤–æ–∑–≤—Ä–∞—â–µ–Ω.', '‚úÖ'); // –õ–æ–≥–∏—Ä—É–µ–º —É—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç
    } catch (error) {
        logAction(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–ø–∏—Å–∫–∞ –º–∞—Å—Ç–µ—Ä–æ–≤: ${error.message}`, '‚ùå'); // –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É
        next(ApiError.internal('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–ø–∏—Å–∫–∞ –º–∞—Å—Ç–µ—Ä–æ–≤.')); // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—à–∏–±–∫—É —Å –ø–æ–º–æ—â—å—é ApiError
    }
});

// –†–æ—É—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–∏–º–µ—Ä–æ–≤ —Ä–∞–±–æ—Ç –º–∞—Å—Ç–µ—Ä–∞, –¥–æ—Å—Ç—É–ø–Ω—ã–π —Ç–æ–ª—å–∫–æ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤
router.get('/:master_id/photos', authMiddleware, roleMiddleware('client'), async (req, res, next) => {
    try {
        logAction(`–ü–æ–ª—É—á–µ–Ω –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–æ–≤ —Ä–∞–±–æ—Ç –º–∞—Å—Ç–µ—Ä–∞ —Å ID: ${req.params.master_id}.`, 'üìù'); // –õ–æ–≥–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–æ–≤ —Ä–∞–±–æ—Ç
        await masterController.getExampleWorks(req, res); // –í—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞ getExampleWorks –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–∏–º–µ—Ä–æ–≤ —Ä–∞–±–æ—Ç –º–∞—Å—Ç–µ—Ä–∞
        logAction(`–ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç –º–∞—Å—Ç–µ—Ä–∞ —Å ID: ${req.params.master_id} —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω—ã.`, '‚úÖ'); // –õ–æ–≥–∏—Ä—É–µ–º —É—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç
    } catch (error) {
        logAction(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø—Ä–∏–º–µ—Ä–æ–≤ —Ä–∞–±–æ—Ç –º–∞—Å—Ç–µ—Ä–∞ —Å ID: ${req.params.master_id}: ${error.message}`, '‚ùå'); // –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É
        next(ApiError.internal('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø—Ä–∏–º–µ—Ä–æ–≤ —Ä–∞–±–æ—Ç –º–∞—Å—Ç–µ—Ä–∞.')); // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—à–∏–±–∫—É —Å –ø–æ–º–æ—â—å—é ApiError
    }
});

// –†–æ—É—Ç –¥–ª—è –≤—Ö–æ–¥–∞ –º–∞—Å—Ç–µ—Ä–∞
router.post('/login', async (req, res, next) => {
    try {
        logAction('–ü–æ–ª—É—á–µ–Ω –∑–∞–ø—Ä–æ—Å –Ω–∞ –≤—Ö–æ–¥ –º–∞—Å—Ç–µ—Ä–∞.', 'üìù'); // –õ–æ–≥–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –≤—Ö–æ–¥ –º–∞—Å—Ç–µ—Ä–∞
        await masterController.loginMaster(req, res); // –í—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞ loginMaster –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –¥–ª—è –≤—Ö–æ–¥–∞ –º–∞—Å—Ç–µ—Ä–∞
        logAction('–ú–∞—Å—Ç–µ—Ä —É—Å–ø–µ—à–Ω–æ –≤–æ—à–µ–ª –≤ —Å–∏—Å—Ç–µ–º—É.', '‚úÖ'); // –õ–æ–≥–∏—Ä—É–µ–º —É—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥
    } catch (error) {
        logAction(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ –º–∞—Å—Ç–µ—Ä–∞: ${error.message}`, '‚ùå'); // –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É
        next(ApiError.internal('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ –º–∞—Å—Ç–µ—Ä–∞.')); // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—à–∏–±–∫—É —Å –ø–æ–º–æ—â—å—é ApiError
    }
});

// –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä, —á—Ç–æ–±—ã –µ–≥–æ –º–æ–∂–Ω–æ –±—ã–ª–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –¥—Ä—É–≥–∏—Ö —á–∞—Å—Ç—è—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
module.exports = router;
